@using BreakOutGame.Models.Domain
@model IEnumerable<BreakOutGame.Models.Domain.BoBGroup>
@{
    ViewData["Title"] = "Index";
}

<h2>Index</h2>
<div class="grouplist">
    @foreach (var group in Model)
    {   
        <div id="@("groupparent" + "_" + group.GroupName.Replace(" ", "_"))" class="col-xs-12 col-sm-6 col-md-6 groupparent">
            <div class="overlay"></div>
            <div class="group @(group.Status != GroupStatus.NotSelected ? "" : "groupselected")" id="@(group.GroupName.Replace(" ", "_"))">

                <p>@group.GroupName</p>
                <hr/>
                <img alt="De groepsafbeelding" src="/images/group.png" class="groupimg" />
                <p>Groepsleden</p>
                <ul class="groupmemberlist">
                    @foreach (var groupStudent in group.Students)
                    {

                        <li>@groupStudent.Student.FirstName @groupStudent.Student.LastName</li>
                    }
                </ul>

                <a asp-action="Index">Test</a>
                <input class="nonclick"type="text"/>
            </div>
            <div class="confirmation hidden group sideDiv" id="@((group.GroupName.Replace(" ", "_")) + "hid")">
                <p>Ben je zeker dat je <strong>@group.GroupName</strong> wilt kiezen als je actieve groep?
                </p>
                <p>Groepsleden</p>
                <ul class="groupmemberlist">
                    @foreach (var groupStudent in group.Students)
                    {

                        <li>@groupStudent.Student.FirstName @groupStudent.Student.LastName</li>
                    }
                </ul>
                <a class="btn btn-primary nonclick" asp-action="WaitScreen" asp-route-id="@group.Id">Kies deze groep</a>
                <a class="btn btn-danger">Nee ik ben toch niet zeker</a>
            </div>
        </div>
           
    }
</div>
<script>
    window.onload = function () {
        var doingstuff = false;
  
        $(".grouplist").find(".group").each(function(index, item) {
            $(item).click(function(e) {
                if (!$(e.target).hasClass("nonclick") && !$(item).hasClass("groupselected")) {
                    console.log("click");
                    console.log($(e.target));
                    if ($(this).hasClass("sideDiv")) {
                        console.log("snap");
                        doingstuff = false;
                    }
                    else
                        doingstuff = true;
                    console.log($(item).attr("id"));

                    $(".grouplist").find(".group").each(function(index2, item2) {
                        $(item2).removeClass("hidden");

                    });

                    $(".grouplist").find(".confirmation").each(function(index2, item2) {
                        $(item2).addClass("hidden");

                    });

                    $(item).addClass("hidden");
                    $("#" + $(item).attr("id") + "hid").removeClass("hidden");
                    console.log("#" + $(item).attr("id") + "hid");
                    $("html, body").animate({
                        scrollTop: $("#groupparent_" + $(item).attr("id")).offset().top - 80
                    }, 'slow');
                    
                }
            });
        });
        $(document).bind("ajaxSend", function () {
            console.log("waiting for all requests to complete...");
            // ajaxStop (Global Event)
            // This global event is triggered if there are no more Ajax requests being processed.
        }).bind("ajaxStop", function () {
            // maybe reload here?
            location.reload();
            });
        setInterval(function () {
            console.log(doingstuff);
            if (!doingstuff)
                $.ajax({ url: "/BoBGroup/Index/" });
        }, 2000);

    };
  
</script>